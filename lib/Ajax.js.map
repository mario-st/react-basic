{"version":3,"sources":["Ajax.jsx"],"names":[],"mappings":"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","file":"Ajax.js","sourcesContent":["\"use strict\";\n\nexport const TIMEOUT          = 10000;\nexport const HEADER_DATA_TYPE = \"application/json\";\nexport const ERR_TIMEOUT      = \"timeout\";\nexport const ERR_DEFAULT      = \"error\";\nexport const NOT_AUTHORIZED   = \"not_authorized\";\n\nclass Ajax {\n\n    constructor (request, dispatcher, timeout) {\n        this._req        = request;\n        this._dispatcher = dispatcher;\n        this._timeout    = timeout || TIMEOUT;\n        this._pending    = {};\n    }\n\n    get (key, url, query, timeout) {\n        return this._send(key, url, (fullUrl) => this._genRequest('get', fullUrl, query, null, timeout));\n    }\n\n    post (key, url, query, body, timeout) {\n        return this._send(key, url, (fullUrl) => this._genRequest('post', fullUrl, query, body, timeout));\n    }\n\n    put (key, url, query, body, timeout) {\n        return this._send(key, url, (fullUrl) => this._genRequest('put', fullUrl, query, body, timeout));\n    }\n\n    del (key, url, query, timeout) {\n        return this._send(key, url, (fullUrl) => this._genRequest('del', fullUrl, query, null, timeout));\n    }\n\n    static _createUrl (url) {\n        return url;\n    }\n\n    _genRequest (method, url, query, body, timeout) {\n        let req = this._req[ method ](url);\n        if (query) {\n            req.query(query);\n        }\n        if (body) {\n            req.send(body);\n        }\n        return req.timeout(timeout || this._timeout).set('Accept', HEADER_DATA_TYPE);\n    }\n\n    _dispatch (key, response, err) {\n        this._dispatcher.dispatch({\n            action: key,\n            data  : response,\n            err   : err\n        });\n    }\n\n    _dispatchResponse (key) {\n        return (err, response) => {\n            if (err) {\n                if (err.timeout === ERR_TIMEOUT) {\n                    this._dispatch(ERR_TIMEOUT, response, err);\n                }\n                else {\n                    this._dispatch(ERR_DEFAULT, response, err);\n                }\n            }\n            else if (response.status === 400) {\n                this._dispatch(NOT_AUTHORIZED, response);\n            }\n            else if (!response.ok) {\n                this._dispatch(ERR_DEFAULT, response);\n            }\n            else {\n                this._dispatch(key, response);\n            }\n        };\n    }\n\n    _abortPendingRequest (key) {\n        let pending = this._pending[ key ];\n        if (pending) {\n            pending._callback = () => {\n            };\n            pending.abort();\n            this._pending[ key ] = null;\n        }\n    }\n\n    _send (key, url, fn) {\n        this._abortPendingRequest(key);\n        let req = this._pending[ key ] = fn.call(this, Ajax._createUrl(url));\n        req.end(this._dispatchResponse(key));\n        return req;\n    }\n\n}\n\nexport default Ajax;"],"sourceRoot":"/source/"}